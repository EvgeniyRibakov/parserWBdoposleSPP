# –ò–ù–°–¢–†–£–ö–¶–ò–Ø: Discovery –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö API —á–µ—Ä–µ–∑ mitmproxy

## üéØ –¶–µ–ª—å

–ù–∞–π—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:
- **WB:** –¶–µ–Ω–∞ –ø–æ—Å–ª–µ –°–ü–ü (–±–µ–∑ –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏)
- **Ozon:** –¶–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∑–µ–ª–µ–Ω–∞—è —Ü–µ–Ω–∞)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞

```bash
python parsers/discovery/start_discovery.py
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:
```bash
python parsers/discovery/mitmproxy_capture.py
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ–∫—Å–∏ –Ω–∞ –ø–æ—Ä—Ç—É **8080**.

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (–ø—Ä–æ—â–µ)**

–ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –æ–∫–Ω–∞ Chrome, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
chrome.exe --proxy-server="http://localhost:8080" --user-data-dir="C:\temp\chrome_proxy"
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ß–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Windows**

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–µ—Ç—å –∏ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Üí –ü—Ä–æ–∫—Å–∏
2. –í–∫–ª—é—á–∏—Ç–µ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä"
3. –ê–¥—Ä–µ—Å: `localhost`, –ü–æ—Ä—Ç: `8080`

**–í–∞—Ä–∏–∞–Ω—Ç –í: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞**

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Proxy SwitchyOmega –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ.

### –®–∞–≥ 3: –ü–µ—Ä–µ—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ WB

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø—Ä–æ–∫—Å–∏
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `https://www.wildberries.ru`
3. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å** –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ (–∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å)
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ —Å –°–ü–ü
5. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
6. –û—Ç–∫—Ä–æ–π—Ç–µ –µ—â–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
7. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –Ω–∞–∂–º–∏—Ç–µ **Ctrl+C** –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

### –®–∞–≥ 4: –ü–µ—Ä–µ—Ö–≤–∞—Ç —Ç—Ä–∞—Ñ–∏–∫–∞ Ozon

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://www.ozon.ru`
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ —Å –∫–∞—Ä—Ç–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–∑–µ–ª–µ–Ω–∞—è —Ü–µ–Ω–∞)
4. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. –ù–∞–∂–º–∏—Ç–µ **Ctrl+C** –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

### –®–∞–≥ 5: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data/captured_requests/`

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª—ã `.json` –∏ –∏—â–∏—Ç–µ:
- –ó–∞–ø—Ä–æ—Å—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏: `price`, `spp`, `card`, `wallet`, `discount`
- –û—Ç–≤–µ—Ç—ã —Å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ —Ü–µ–Ω—ã
- –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ GraphQL –∑–∞–ø—Ä–æ—Å—ã

## üìã –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### –î–ª—è WB: –¶–µ–Ω–∞ –ø–æ—Å–ª–µ –°–ü–ü

–ò—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∏–ø–∞:

```json
{
  "price": 1000,              // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
  "discountedPrice": 900,     // –¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π (–¥–æ –°–ü–ü)
  "priceAfterSPP": 800,       // –¶–ï–ù–ê –ü–û–°–õ–ï –°–ü–ü (–ë–ï–ó –ö–ê–†–¢–´) - –≠–¢–û –ù–£–ñ–ù–û!
  "clubDiscountedPrice": 700  // –¶–µ–Ω–∞ –ø–æ—Å–ª–µ –°–ü–ü + –∫–∞—Ä—Ç–∞
}
```

–ò–ª–∏ –ø–æ—Ö–æ–∂–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –¥—Ä—É–≥–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –ø–æ–ª–µ–π.

### –î–ª—è Ozon: –¶–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π

–ò—â–∏—Ç–µ –∑–∞–ø—Ä–æ—Å—ã —Å "–∑–µ–ª–µ–Ω–æ–π —Ü–µ–Ω–æ–π" (—Ü–µ–Ω–∞ —Å –∫–∞—Ä—Ç–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏).

## üîç –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: DevTools (–µ—Å–ª–∏ mitmproxy –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Chrome ‚Üí **F12** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network**
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
3. –§–∏–ª—å—Ç—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ –¥–æ–º–µ–Ω—É (`wildberries.ru` –∏–ª–∏ `ozon.ru`)
4. –ò—â–∏—Ç–µ **XHR/Fetch** –∑–∞–ø—Ä–æ—Å—ã
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π ‚Üí **Copy** ‚Üí **Copy as cURL**
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `parsers/api/wb/internal_api.py`:

```python
def get_price_after_spp(self, article: str) -> Optional[float]:
    url = "https://–Ω–∞–π–¥–µ–Ω–Ω—ã–π-—ç–Ω–¥–ø–æ–∏–Ω—Ç.ru/api/..."
    headers = {
        "Authorization": "...",
        "Cookie": "..."
    }
    params = {"nmID": article}
    
    response = self.session.get(url, headers=headers, params=params)
    data = response.json()
    return data["priceAfterSPP"]  # –∏–ª–∏ –¥—Ä—É–≥–æ–µ –ø–æ–ª–µ
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** - –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ü–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏
2. **–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –õ–ö
3. **Cookies** - —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–∞—Ä—Å–µ—Ä–µ
4. **–¢–æ–∫–µ–Ω—ã** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç 8080 —Å–≤–æ–±–æ–¥–µ–Ω
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç: `start_capture(port=8888)`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ø—Ä–æ–∫—Å–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ mitmproxy –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∫—Å–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ
- –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–µ —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É)

